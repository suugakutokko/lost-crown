<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Lost Crown - æ¶ˆãˆãŸç‹å† ã®æ—…</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #1a0033 0%, #0d001a 50%, #000000 100%);
            color: white;
            overflow: hidden;
            position: relative;
            width: 100vw;
            height: 100vh;
        }

        /* æ˜Ÿã®ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«èƒŒæ™¯ */
        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        .star {
            position: absolute;
            width: 2px;
            height: 2px;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        /* ç”»é¢ã®åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ« */
        .screen {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            padding: 20px;
            overflow-y: auto;
            z-index: 1;
        }

        .screen.active {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ */
        .title-screen {
            text-align: center;
        }

        .game-title {
            font-size: 4rem;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 0 0 20px #ffd700, 0 0 40px #ffd700, 0 0 60px #ff8800;
            margin-bottom: 1rem;
            animation: glow-pulse 2s infinite;
        }

        @keyframes glow-pulse {
            0%, 100% { text-shadow: 0 0 20px #ffd700, 0 0 40px #ffd700; }
            50% { text-shadow: 0 0 30px #ffd700, 0 0 60px #ffd700, 0 0 80px #ff8800; }
        }

        .subtitle {
            font-size: 1.2rem;
            color: #c8b8ff;
            margin-bottom: 3rem;
        }

        /* ã‚°ãƒ©ã‚¹ãƒ¢ãƒ¼ãƒ•ã‚£ã‚ºãƒ ãƒœã‚¿ãƒ³ */
        .glass-button {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 15px 40px;
            font-size: 1.2rem;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            animation: button-pulse 2s infinite;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
        }

        @keyframes button-pulse {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.3); }
            50% { box-shadow: 0 0 30px rgba(255, 215, 0, 0.5); }
        }

        .glass-button:active {
            transform: scale(0.95);
        }

        .glass-button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        /* ã‚­ãƒ£ãƒ©é¸æŠç”»é¢ */
        .character-select-screen {
            justify-content: flex-start;
            padding-top: 40px;
        }

        .select-title {
            font-size: 2rem;
            color: #ffd700;
            margin-bottom: 2rem;
            text-shadow: 0 0 10px #ffd700;
        }

        .character-cards {
            width: 100%;
            max-width: 400px;
            margin-bottom: 2rem;
        }

        .character-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .character-card:hover {
            transform: translateY(-5px);
        }

        .character-card.selected {
            border-color: #ffd700;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
            background: rgba(255, 215, 0, 0.1);
        }

        .character-card.dimmed {
            opacity: 0.4;
        }

        .char-emoji {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        .char-name {
            font-size: 1.5rem;
            color: #ffd700;
            margin-bottom: 5px;
        }

        .char-title {
            font-size: 1rem;
            color: #c8b8ff;
            margin-bottom: 15px;
        }

        .char-stats {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-bottom: 10px;
        }

        .stat {
            text-align: center;
            font-size: 0.8rem;
        }

        .stat-value {
            font-weight: bold;
            color: #ffd700;
        }

        .char-skills {
            font-size: 0.9rem;
            color: #c8b8ff;
            line-height: 1.5;
        }

        /* æˆ¦é—˜ç”»é¢ */
        .battle-screen {
            justify-content: space-between;
            padding: 20px;
        }

        .enemy-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
        }

        .enemy-emoji {
            font-size: 6rem;
            margin-bottom: 10px;
            transition: all 0.3s;
        }

        .enemy-name {
            font-size: 1.5rem;
            color: #ffd700;
            margin-bottom: 10px;
        }

        .hp-bar-container {
            width: 100%;
            max-width: 300px;
            height: 25px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.3);
            position: relative;
        }

        .hp-bar {
            height: 100%;
            background: linear-gradient(90deg, #ff4444, #ff8800);
            transition: width 0.5s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .hp-bar.player {
            background: linear-gradient(90deg, #44ff44, #00aaff);
        }

        .mp-bar-container {
            width: 100%;
            max-width: 300px;
            height: 20px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.3);
            margin-top: 5px;
        }

        .mp-bar {
            height: 100%;
            background: linear-gradient(90deg, #aa44ff, #ff44aa);
            transition: width 0.5s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
        }

        .battle-log {
            background: rgba(0, 0, 0, 0.6);
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            min-height: 60px;
            max-height: 100px;
            overflow-y: auto;
            font-size: 0.9rem;
            line-height: 1.5;
            color: #c8b8ff;
        }

        .player-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .player-emoji {
            font-size: 5rem;
            margin-bottom: 10px;
            transition: all 0.3s;
        }

        .player-name {
            font-size: 1.3rem;
            color: #ffd700;
            margin-bottom: 10px;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            width: 100%;
            max-width: 400px;
            margin-top: 10px;
        }

        .action-btn {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 12px;
            font-size: 0.9rem;
            color: white;
            cursor: pointer;
            transition: all 0.2s;
        }

        .action-btn:active {
            transform: scale(0.9);
        }

        .action-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        /* ãƒ€ãƒ¡ãƒ¼ã‚¸ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— */
        .damage-popup {
            position: absolute;
            font-size: 2rem;
            font-weight: bold;
            color: white;
            text-shadow: 0 0 10px black, 0 0 20px black;
            pointer-events: none;
            animation: damage-rise 1s forwards;
        }

        .damage-popup.critical {
            color: #ffd700;
            font-size: 3rem;
        }

        @keyframes damage-rise {
            0% {
                opacity: 1;
                transform: translateY(0);
            }
            100% {
                opacity: 0;
                transform: translateY(-100px);
            }
        }

        /* æ”»æ’ƒã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        @keyframes attack-rush {
            0% { transform: translateY(0); }
            50% { transform: translateY(-100px); }
            100% { transform: translateY(0); }
        }

        @keyframes blur-pulse {
            0% { filter: blur(0); transform: scale(1); }
            50% { filter: blur(5px); transform: scale(1.1); }
            100% { filter: blur(0); transform: scale(1); }
        }

        @keyframes flash-white {
            0% { background: transparent; }
            50% { background: rgba(255, 255, 255, 0.8); }
            100% { background: transparent; }
        }

        .flash-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
        }

        /* ã‚¹ã‚­ãƒ«ãƒ¡ãƒ‹ãƒ¥ãƒ¼ */
        .skill-menu {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-top: 2px solid #ffd700;
            z-index: 100;
            display: none;
        }

        .skill-menu.active {
            display: block;
            animation: slide-up 0.3s;
        }

        @keyframes slide-up {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }

        .skill-option {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .skill-option:active {
            transform: scale(0.95);
            background: rgba(255, 255, 255, 0.2);
        }

        .skill-option.disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .skill-name {
            font-size: 1.1rem;
            color: #ffd700;
            margin-bottom: 5px;
        }

        .skill-desc {
            font-size: 0.9rem;
            color: #c8b8ff;
            margin-bottom: 5px;
        }

        .skill-cost {
            font-size: 0.8rem;
            color: #ff44aa;
        }

        /* å‹åˆ©/æ•—åŒ—ç”»é¢ */
        .result-screen {
            text-align: center;
        }

        .result-title {
            font-size: 3rem;
            margin-bottom: 2rem;
            text-shadow: 0 0 20px currentColor;
        }

        .result-title.victory {
            color: #ffd700;
            animation: glow-pulse 1s infinite;
        }

        .result-title.defeat {
            color: #ff4444;
        }

        .result-info {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 2rem;
            font-size: 1.2rem;
        }

        .result-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        /* ãƒãƒƒãƒ—ç”»é¢ */
        .map-screen {
            justify-content: flex-start;
            padding: 10px;
        }

        .status-bar {
            width: 100%;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            font-size: 0.9rem;
        }

        .status-item {
            text-align: center;
        }

        .status-label {
            color: #c8b8ff;
            font-size: 0.8rem;
        }

        .status-value {
            color: #ffd700;
            font-size: 1.1rem;
            font-weight: bold;
        }

        .map-title {
            font-size: 2rem;
            color: #ffd700;
            text-align: center;
            margin-bottom: 1.5rem;
            text-shadow: 0 0 10px #ffd700;
        }

        .area-list {
            width: 100%;
            max-width: 500px;
            overflow-y: auto;
            padding-bottom: 20px;
        }

        .area-card {
            background: rgba(255, 255, 255, 0.06);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .area-card.locked {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .area-card.available {
            border-color: #ffd700;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
            animation: glow-pulse 2s infinite;
        }

        .area-card.cleared {
            border-color: #4caf50;
            opacity: 0.7;
            cursor: default;
        }

        .area-emoji {
            font-size: 3rem;
        }

        .area-info {
            flex: 1;
        }

        .area-name {
            font-size: 1.3rem;
            color: #ffd700;
            margin-bottom: 5px;
        }

        .area-desc {
            font-size: 0.9rem;
            color: #c8b8ff;
        }

        .area-status {
            font-size: 0.9rem;
            font-weight: bold;
        }

        .area-status.locked-text {
            color: #888;
        }

        .area-status.cleared-text {
            color: #4caf50;
        }

        /* ã‚¨ãƒªã‚¢è©³ç´°ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— */
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 200;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .popup-overlay.active {
            display: flex;
        }

        .popup-content {
            background: rgba(20, 0, 40, 0.95);
            backdrop-filter: blur(20px);
            border: 2px solid #ffd700;
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
            text-align: center;
        }

        .popup-title {
            font-size: 2rem;
            color: #ffd700;
            margin-bottom: 20px;
            text-shadow: 0 0 10px #ffd700;
        }

        .popup-desc {
            font-size: 1rem;
            color: #c8b8ff;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .popup-enemy {
            font-size: 1.2rem;
            margin-bottom: 30px;
        }

        .popup-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
    </style>
</head>
<body>
    <!-- æ˜Ÿã®ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«èƒŒæ™¯ -->
    <div class="stars" id="stars"></div>

    <!-- ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
    <div class="flash-overlay" id="flashOverlay"></div>

    <!-- ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ -->
    <div class="screen active" id="titleScreen">
        <!-- checkSaveData()ã§å†…å®¹ãŒè¨­å®šã•ã‚Œã‚‹ -->
    </div>

    <!-- ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼é¸æŠç”»é¢ -->
    <div class="screen" id="characterSelectScreen">
        <h2 class="select-title">è‹±é›„ã‚’é¸ã‚“ã§</h2>
        <div class="character-cards" id="characterCards"></div>
        <button class="glass-button" id="startAdventureBtn" onclick="goToMap()" disabled>å‡ºç™º</button>
    </div>

    <!-- ãƒãƒƒãƒ—ç”»é¢ -->
    <div class="screen" id="mapScreen">
        <div class="status-bar">
            <div class="status-item">
                <div class="status-label">ãƒ¬ãƒ™ãƒ«</div>
                <div class="status-value" id="statusLevel">1</div>
            </div>
            <div class="status-item">
                <div class="status-label">HP</div>
                <div class="status-value" id="statusHp">100/100</div>
            </div>
            <div class="status-item">
                <div class="status-label">MP</div>
                <div class="status-value" id="statusMp">50/50</div>
            </div>
            <div class="status-item">
                <div class="status-label">ã‚´ãƒ¼ãƒ«ãƒ‰</div>
                <div class="status-value" id="statusGold">0</div>
            </div>
        </div>
        <h2 class="map-title">ã‚¢ãƒ«ã‚¬ãƒ¬ã‚¤ã‚¢ã®åœ°</h2>
        <div class="area-list" id="areaList"></div>
    </div>

    <!-- ã‚¨ãƒªã‚¢è©³ç´°ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— -->
    <div class="popup-overlay" id="areaPopup">
        <div class="popup-content">
            <div class="popup-title" id="popupTitle">ã‚¨ãƒªã‚¢å</div>
            <div class="popup-desc" id="popupDesc">ã‚¨ãƒªã‚¢ã®èª¬æ˜</div>
            <div class="popup-enemy" id="popupEnemy">ğŸ‰ ãƒ‰ãƒ©ã‚´ãƒ³</div>
            <div class="popup-buttons">
                <button class="glass-button" onclick="closeAreaPopup()">æˆ»ã‚‹</button>
                <button class="glass-button" onclick="startBattleFromMap()">çªé€²ã™ã‚‹</button>
            </div>
        </div>
    </div>

    <!-- æˆ¦é—˜ç”»é¢ -->
    <div class="screen" id="battleScreen">
        <div class="enemy-area">
            <div class="enemy-emoji" id="enemyEmoji">ğŸ‘¹</div>
            <div class="enemy-name" id="enemyName">æ•µã®åå‰</div>
            <div class="hp-bar-container">
                <div class="hp-bar" id="enemyHpBar">
                    <span id="enemyHpText">100/100</span>
                </div>
            </div>
        </div>

        <div class="battle-log" id="battleLog">æˆ¦é—˜é–‹å§‹ï¼</div>

        <div class="player-area">
            <div class="player-emoji" id="playerEmoji">âš”ï¸</div>
            <div class="player-name" id="playerName">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼</div>
            <div class="hp-bar-container">
                <div class="hp-bar player" id="playerHpBar">
                    <span id="playerHpText">100/100</span>
                </div>
            </div>
            <div class="mp-bar-container">
                <div class="mp-bar" id="playerMpBar">
                    <span id="playerMpText">50/50</span>
                </div>
            </div>
        </div>

        <div class="action-buttons">
            <button class="action-btn" onclick="playerAttack()">âš”ï¸ æ”»æ’ƒ</button>
            <button class="action-btn" onclick="openSkillMenu()">âœ¨ ã‚¹ã‚­ãƒ«</button>
            <button class="action-btn" onclick="useUltimate()">ğŸ’¥ å¿…æ®ºæŠ€</button>
            <button class="action-btn" onclick="openItemMenu()">ğŸ§ª ã‚¢ã‚¤ãƒ†ãƒ </button>
            <button class="action-btn" onclick="retreat()">ğŸƒ æ’¤é€€</button>
        </div>
    </div>

    <!-- ã‚¹ã‚­ãƒ«ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
    <div class="skill-menu" id="skillMenu">
        <h3 style="color: #ffd700; margin-bottom: 15px;">ã‚¹ã‚­ãƒ«ã‚’é¸æŠ</h3>
        <div id="skillOptions"></div>
        <button class="glass-button" style="width: 100%; margin-top: 10px;" onclick="closeSkillMenu()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
    </div>

    <!-- ã‚¢ã‚¤ãƒ†ãƒ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
    <div class="skill-menu" id="itemMenu">
        <h3 style="color: #ffd700; margin-bottom: 15px;">ã‚¢ã‚¤ãƒ†ãƒ ã‚’é¸æŠ</h3>
        <div id="itemOptions"></div>
        <button class="glass-button" style="width: 100%; margin-top: 10px;" onclick="closeItemMenu()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
    </div>

    <!-- å‹åˆ©/æ•—åŒ—ç”»é¢ -->
    <div class="screen" id="resultScreen">
        <h2 class="result-title" id="resultTitle">å‹åˆ©ï¼</h2>
        <div class="result-info" id="resultInfo"></div>
        <div class="result-buttons">
            <button class="glass-button" onclick="returnToTitle()">ã‚¿ã‚¤ãƒˆãƒ«ã¸</button>
            <button class="glass-button" onclick="playAgain()">ã‚‚ã†ä¸€åº¦</button>
        </div>
    </div>

    <!-- ã‚¨ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ -->
    <div class="screen" id="endingScreen">
        <h2 class="result-title victory" style="font-size: 2.5rem; margin-bottom: 3rem;">
            ãŠã‚ã§ã¨ã†ï¼
        </h2>
        <div class="result-info" style="font-size: 1.1rem; line-height: 2;">
            <div style="margin-bottom: 20px;">ğŸ‘‘ ç‹å† ã‚’å–ã‚Šæˆ»ã—ãŸï¼ ğŸ‘‘</div>
            <div style="margin-bottom: 20px;">ã‚¢ãƒ«ã‚¬ãƒ¬ã‚¤ã‚¢ã«å¹³å’ŒãŒæˆ»ã£ãŸã€‚</div>
            <div style="margin-top: 30px; color: #c8b8ff;">
                <div>æœ€çµ‚ãƒ¬ãƒ™ãƒ«: Lv.${playerLevel}</div>
                <div>ç²å¾—ã‚´ãƒ¼ãƒ«ãƒ‰: ${playerGold}</div>
            </div>
        </div>
        <div style="text-align: center; margin-top: 3rem;">
            <button class="glass-button" onclick="returnToTitle()">ã‚¿ã‚¤ãƒˆãƒ«ã«æˆ»ã‚‹</button>
        </div>
    </div>

    <script>
        // ã‚²ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿
        const gameData = {
            "characters": [
                {
                    "id": "warrior",
                    "name": "ãƒ¬ã‚ªãƒ³",
                    "title": "è–é¨å£«",
                    "emoji": "âš”ï¸",
                    "description": "ç‹å›½ã®å®ˆè­·é¨å£«ã€‚é«˜ã„é˜²å¾¡åŠ›ã¨ä½“åŠ›ã§å‘³æ–¹ã‚’å®ˆã‚‹ã€‚åŠ›å¼·ã„ä¸€æ’ƒãŒæŒã¡å‘³ã€‚",
                    "base_stats": { "hp": 150, "mp": 30, "atk": 25, "def": 20, "spd": 10 },
                    "skills": [
                        {
                            "id": "heavy_slash",
                            "name": "ãƒ˜ãƒ“ãƒ¼ã‚¹ãƒ©ãƒƒã‚·ãƒ¥",
                            "description": "å¼·åŠ›ãªä¸€æ’ƒã‚’æ”¾ã¤",
                            "mp_cost": 8,
                            "damage_multiplier": 2.0,
                            "effect": "single_target"
                        },
                        {
                            "id": "iron_wall",
                            "name": "é‰„å£ã®å®ˆã‚Š",
                            "description": "æ¬¡ã®ã‚¿ãƒ¼ãƒ³ã®ãƒ€ãƒ¡ãƒ¼ã‚¸ã‚’åŠæ¸›ã™ã‚‹",
                            "mp_cost": 12,
                            "damage_multiplier": 0,
                            "effect": "defense_buff"
                        }
                    ],
                    "ultimate": {
                        "id": "divine_strike",
                        "name": "è–ãªã‚‹ä¸€é–ƒ",
                        "description": "ç¥ã®åŠ è­·ã‚’å—ã‘ãŸæ¸¾èº«ã®ä¸€æ’ƒ",
                        "mp_cost": 25,
                        "damage_multiplier": 4.5,
                        "effect": "ignore_def"
                    }
                },
                {
                    "id": "mage",
                    "name": "ã‚»ãƒ¬ãƒŠ",
                    "title": "é­”å°å¸«",
                    "emoji": "ğŸ”®",
                    "description": "å¤ä»£é­”æ³•ã‚’æ“ã‚‹è³¢è€…ã€‚å¼·åŠ›ãªé­”æ³•æ”»æ’ƒã§æ•µã‚’æ®²æ»…ã™ã‚‹ã€‚",
                    "base_stats": { "hp": 80, "mp": 80, "atk": 35, "def": 8, "spd": 15 },
                    "skills": [
                        {
                            "id": "fireball",
                            "name": "ãƒ•ã‚¡ã‚¤ã‚¢ãƒœãƒ¼ãƒ«",
                            "description": "ç‚ã®çƒã‚’æ”¾ã¤å¼·åŠ›ãªé­”æ³•",
                            "mp_cost": 15,
                            "damage_multiplier": 2.5,
                            "effect": "single_target"
                        },
                        {
                            "id": "burn_curse",
                            "name": "ç¼ç†±ã®å‘ªã„",
                            "description": "æ•µã«ç¶™ç¶šãƒ€ãƒ¡ãƒ¼ã‚¸ã‚’ä¸ãˆã‚‹",
                            "mp_cost": 10,
                            "damage_multiplier": 1.2,
                            "effect": "burn"
                        }
                    ],
                    "ultimate": {
                        "id": "meteor_storm",
                        "name": "ãƒ¡ãƒ†ã‚ªã‚¹ãƒˆãƒ¼ãƒ ",
                        "description": "å¤©ã‹ã‚‰éš•çŸ³ã®é›¨ã‚’é™ã‚‰ã›ã‚‹ç©¶æ¥µé­”æ³•",
                        "mp_cost": 40,
                        "damage_multiplier": 6.0,
                        "effect": "ignore_def"
                    }
                },
                {
                    "id": "rogue",
                    "name": "ã‚·ãƒ£ãƒ‰ã‚¦",
                    "title": "æš—æ®ºè€…",
                    "emoji": "ğŸ—¡ï¸",
                    "description": "å½±ã‚’æ“ã‚‹ç¥é€Ÿã®æˆ¦å£«ã€‚ç´ æ—©ã„å‹•ãã§æ•µã‚’ç¿»å¼„ã—ã€é€£ç¶šæ”»æ’ƒã§ç¢ºå®Ÿã«ä»•ç•™ã‚ã‚‹ã€‚",
                    "base_stats": { "hp": 110, "mp": 50, "atk": 28, "def": 12, "spd": 30 },
                    "skills": [
                        {
                            "id": "triple_strike",
                            "name": "ä¸‰é€£æ–¬",
                            "description": "é«˜é€Ÿã§3å›æ–¬ã‚Šã¤ã‘ã‚‹",
                            "mp_cost": 12,
                            "damage_multiplier": 1.3,
                            "effect": "multi_hit",
                            "hit_count": 3
                        },
                        {
                            "id": "shadow_step",
                            "name": "å½±æ¸¡ã‚Š",
                            "description": "ç´ æ—©ãå‹•ã„ã¦ç¢ºå®Ÿã«æ”»æ’ƒã™ã‚‹",
                            "mp_cost": 8,
                            "damage_multiplier": 1.8,
                            "effect": "guaranteed_hit"
                        }
                    ],
                    "ultimate": {
                        "id": "phantom_blade",
                        "name": "å¹»å½±åˆƒèˆ",
                        "description": "ç„¡æ•°ã®å¹»å½±ãŒæ•µã‚’åˆ‡ã‚Šåˆ»ã‚€",
                        "mp_cost": 30,
                        "damage_multiplier": 2.0,
                        "effect": "multi_hit",
                        "hit_count": 7
                    }
                }
            ],
            "enemies": [
                {
                    "id": "forest_goblin",
                    "name": "ãƒ•ã‚©ãƒ¬ã‚¹ãƒˆã‚´ãƒ–ãƒªãƒ³",
                    "emoji": "ğŸ‘¹",
                    "description": "æ£®ã«æ£²ã‚€å°å‹ã®é­”ç‰©ã€‚ç´ æ—©ãæ”»æ’ƒã—ã¦ãã‚‹ã€‚",
                    "base_stats": { "hp": 50, "mp": 20, "atk": 15, "def": 8, "spd": 12 },
                    "ai_type": "random",
                    "skills": [
                        { "id": "quick_stab", "name": "ç´ æ—©ã„çªã", "mp_cost": 5, "damage_multiplier": 1.5 }
                    ],
                    "exp_reward": 25,
                    "gold_reward": 15,
                    "is_boss": false,
                    "is_final_boss": false
                },
                {
                    "id": "desert_scorpion",
                    "name": "ãƒ‡ã‚¶ãƒ¼ãƒˆã‚¹ã‚³ãƒ¼ãƒ”ã‚ªãƒ³",
                    "emoji": "ğŸ¦‚",
                    "description": "ç ‚æ¼ ã®å·¨å¤§ã‚µã‚½ãƒªã€‚æ¯’ã‚’æŒã¤å±é™ºãªç”Ÿç‰©ã€‚",
                    "base_stats": { "hp": 80, "mp": 25, "atk": 22, "def": 15, "spd": 10 },
                    "ai_type": "strong_attack",
                    "skills": [
                        { "id": "poison_sting", "name": "æ¯’é‡", "mp_cost": 8, "damage_multiplier": 2.0 }
                    ],
                    "exp_reward": 40,
                    "gold_reward": 25,
                    "is_boss": false,
                    "is_final_boss": false
                },
                {
                    "id": "ice_golem",
                    "name": "ã‚¢ã‚¤ã‚¹ã‚´ãƒ¼ãƒ¬ãƒ ",
                    "emoji": "â›„",
                    "description": "æ°·ã®å±±ã«ç¾ã‚Œã‚‹å·¨å¤§ãªæ°·ã®é­”ç‰©ã€‚",
                    "base_stats": { "hp": 120, "mp": 30, "atk": 28, "def": 25, "spd": 5 },
                    "ai_type": "strong_attack",
                    "skills": [
                        { "id": "ice_crush", "name": "æ°·çµç •", "mp_cost": 10, "damage_multiplier": 2.2 }
                    ],
                    "exp_reward": 60,
                    "gold_reward": 40,
                    "is_boss": false,
                    "is_final_boss": false
                },
                {
                    "id": "dark_knight",
                    "name": "ãƒ€ãƒ¼ã‚¯ãƒŠã‚¤ãƒˆ",
                    "emoji": "ğŸ›¡ï¸",
                    "description": "é—‡ã«å •ã¡ãŸå…ƒé¨å£«ã€‚å¼·åŠ›ãªæ”»æ’ƒã¨å›å¾©èƒ½åŠ›ã‚’æŒã¤ä¸­é–“ãƒœã‚¹ã€‚",
                    "base_stats": { "hp": 200, "mp": 60, "atk": 35, "def": 30, "spd": 18 },
                    "ai_type": "heal_priority",
                    "skills": [
                        { "id": "dark_slash", "name": "é—‡ã®æ–¬æ’ƒ", "mp_cost": 12, "damage_multiplier": 2.5 }
                    ],
                    "heal_skill": {
                        "id": "shadow_heal",
                        "name": "å½±ã®ç™’ã—",
                        "mp_cost": 15,
                        "heal_amount": 50,
                        "trigger_hp_percent": 40
                    },
                    "exp_reward": 150,
                    "gold_reward": 100,
                    "is_boss": true,
                    "is_final_boss": false
                },
                {
                    "id": "marbold",
                    "name": "å¤§é­”ç‹ãƒãƒ«ãƒœãƒ«ãƒ‰",
                    "emoji": "ğŸ‘¿",
                    "description": "ç¥ã®ç‹å† ã‚’å¥ªã£ãŸæ‚ªã®åŒ–èº«ã€‚åœ§å€’çš„ãªåŠ›ã§ä¸–ç•Œã‚’æ”¯é…ã—ã‚ˆã†ã¨ã™ã‚‹æœ€çµ‚ãƒœã‚¹ã€‚",
                    "base_stats": { "hp": 400, "mp": 100, "atk": 50, "def": 40, "spd": 25 },
                    "ai_type": "heal_priority",
                    "skills": [
                        { "id": "chaos_wave", "name": "æ··æ²Œã®æ³¢å‹•", "mp_cost": 20, "damage_multiplier": 3.0 },
                        { "id": "dark_lightning", "name": "é—‡ã®é›·", "mp_cost": 15, "damage_multiplier": 2.5 }
                    ],
                    "heal_skill": {
                        "id": "demonic_regeneration",
                        "name": "é­”ç‹ã®å†ç”Ÿ",
                        "mp_cost": 25,
                        "heal_amount": 100,
                        "trigger_hp_percent": 30
                    },
                    "exp_reward": 500,
                    "gold_reward": 1000,
                    "is_boss": true,
                    "is_final_boss": true
                }
            ],
            "items": [
                {
                    "id": "health_potion",
                    "name": "å›å¾©è–¬",
                    "emoji": "ğŸ’Š",
                    "effect": "restore_hp",
                    "value": 50,
                    "cost": 30,
                    "description": "HPã‚’50å›å¾©ã™ã‚‹"
                }
            ],
            "level_progression": {
                "max_level": 10,
                "stat_growth_per_level": {
                    "hp": 15,
                    "mp": 8,
                    "atk": 3,
                    "def": 2,
                    "spd": 1
                },
                "exp_table": [
                    { "level": 1, "required_exp": 0 },
                    { "level": 2, "required_exp": 50 },
                    { "level": 3, "required_exp": 120 },
                    { "level": 4, "required_exp": 220 },
                    { "level": 5, "required_exp": 350 },
                    { "level": 6, "required_exp": 520 },
                    { "level": 7, "required_exp": 730 },
                    { "level": 8, "required_exp": 990 },
                    { "level": 9, "required_exp": 1300 },
                    { "level": 10, "required_exp": 1700 }
                ]
            }
        };

        // ã‚²ãƒ¼ãƒ çŠ¶æ…‹
        let selectedCharacter = null;
        let playerStats = null;
        let currentEnemy = null;
        let enemyStats = null;
        let ultimateGauge = 0;
        let playerDefenseBuff = false;
        let enemyBurnTurns = 0;
        let playerInventory = { health_potion: 3 };
        let playerLevel = 1;
        let playerExp = 0;
        let playerGold = 0;
        let currentEnemyIndex = 0;
        let clearedEnemies = []; // å€’ã—ãŸæ•µã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒªã‚¹ãƒˆ
        let selectedAreaIndex = null;

        // åˆæœŸåŒ–
        function init() {
            createStars();
            loadCharacterCards();
            checkSaveData();
        }

        // ã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿ã®ç¢ºèª
        function checkSaveData() {
            const saveData = localStorage.getItem('lc_save');
            const titleButtons = document.querySelector('#titleScreen');

            if (saveData) {
                // ã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹å ´åˆã¯2ã¤ã®ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
                titleButtons.innerHTML = `
                    <h1 class="game-title">LOST CROWN</h1>
                    <p class="subtitle">æ¶ˆãˆãŸç‹å† ã®æ—…</p>
                    <button class="glass-button" onclick="loadGame()" style="margin-bottom: 15px;">ç¶šã‘ã¦éŠã¶</button>
                    <button class="glass-button" onclick="newGame()">æ–°è¦é–‹å§‹</button>
                `;
            } else {
                // ã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã¯1ã¤ã®ãƒœã‚¿ãƒ³ã®ã¿
                titleButtons.innerHTML = `
                    <h1 class="game-title">LOST CROWN</h1>
                    <p class="subtitle">æ¶ˆãˆãŸç‹å† ã®æ—…</p>
                    <button class="glass-button" onclick="newGame()">å†’é™ºã¸</button>
                `;
            }
        }

        // æ–°è¦ã‚²ãƒ¼ãƒ é–‹å§‹
        function newGame() {
            localStorage.removeItem('lc_save');
            selectedCharacter = null;
            playerLevel = 1;
            playerExp = 0;
            playerGold = 0;
            clearedEnemies = [];
            switchScreen('characterSelectScreen');
        }

        // ã‚²ãƒ¼ãƒ ã‚’ãƒ­ãƒ¼ãƒ‰
        function loadGame() {
            const saveData = localStorage.getItem('lc_save');
            if (!saveData) return;

            try {
                const data = JSON.parse(saveData);

                // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼é¸æŠ
                selectedCharacter = gameData.characters.find(c => c.id === data.characterId);
                if (!selectedCharacter) return;

                // ãƒ‡ãƒ¼ã‚¿å¾©å…ƒ
                playerLevel = data.level;
                playerExp = data.exp;
                playerGold = data.gold;
                clearedEnemies = data.clearedEnemies || [];

                // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¾©å…ƒ
                playerStats = {
                    hp: data.stats.hp,
                    mp: data.stats.mp,
                    atk: data.stats.atk,
                    def: data.stats.def,
                    spd: data.stats.spd,
                    currentHp: data.stats.currentHp,
                    currentMp: data.stats.currentMp
                };

                // ãƒãƒƒãƒ—ç”»é¢ã¸
                updateMapScreen();
                switchScreen('mapScreen');
            } catch (e) {
                console.error('ã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ', e);
                newGame();
            }
        }

        // ã‚²ãƒ¼ãƒ ã‚’ä¿å­˜
        function saveGame() {
            if (!selectedCharacter) return;

            const saveData = {
                characterId: selectedCharacter.id,
                level: playerLevel,
                exp: playerExp,
                gold: playerGold,
                clearedEnemies: clearedEnemies,
                stats: {
                    hp: playerStats.hp,
                    mp: playerStats.mp,
                    atk: playerStats.atk,
                    def: playerStats.def,
                    spd: playerStats.spd,
                    currentHp: playerStats.currentHp,
                    currentMp: playerStats.currentMp
                }
            };

            localStorage.setItem('lc_save', JSON.stringify(saveData));
        }

        // æ˜Ÿã®ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ç”Ÿæˆ
        function createStars() {
            const starsContainer = document.getElementById('stars');
            for (let i = 0; i < 100; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 3 + 's';
                starsContainer.appendChild(star);
            }
        }

        // ç”»é¢åˆ‡ã‚Šæ›¿ãˆ
        function switchScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        }


        // ãƒãƒƒãƒ—ç”»é¢ã¸é·ç§»
        function goToMap() {
            if (!selectedCharacter) return;

            // åˆå›ã®ã¿åˆæœŸåŒ–
            if (playerLevel === 1 && playerExp === 0 && playerGold === 0) {
                playerLevel = 1;
                playerExp = 0;
                playerGold = 0;
                clearedEnemies = [];

                // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆæœŸåŒ–
                const char = selectedCharacter;
                playerStats = {
                    hp: char.base_stats.hp,
                    mp: char.base_stats.mp,
                    atk: char.base_stats.atk,
                    def: char.base_stats.def,
                    spd: char.base_stats.spd,
                    currentHp: char.base_stats.hp,
                    currentMp: char.base_stats.mp
                };
            }

            updateMapScreen();
            switchScreen('mapScreen');
        }

        // ãƒãƒƒãƒ—ç”»é¢ã®æ›´æ–°
        function updateMapScreen() {
            // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼æ›´æ–°
            document.getElementById('statusLevel').textContent = playerLevel;
            document.getElementById('statusHp').textContent = `${playerStats.currentHp}/${playerStats.hp}`;
            document.getElementById('statusMp').textContent = `${playerStats.currentMp}/${playerStats.mp}`;
            document.getElementById('statusGold').textContent = playerGold;

            // ã‚¨ãƒªã‚¢ãƒªã‚¹ãƒˆæ›´æ–°
            const areaList = document.getElementById('areaList');
            areaList.innerHTML = '';

            gameData.enemies.forEach((enemy, index) => {
                const isCleared = clearedEnemies.includes(index);
                const isAvailable = index === 0 || clearedEnemies.includes(index - 1);
                const isLocked = !isAvailable && !isCleared;

                const card = document.createElement('div');
                card.className = 'area-card';

                if (isCleared) {
                    card.classList.add('cleared');
                } else if (isAvailable) {
                    card.classList.add('available');
                } else {
                    card.classList.add('locked');
                }

                let statusText = '';
                if (isCleared) {
                    statusText = '<div class="area-status cleared-text">âœ“ çªç ´æ¸ˆã¿</div>';
                } else if (isLocked) {
                    statusText = '<div class="area-status locked-text">ğŸ”’ ãƒ­ãƒƒã‚¯ä¸­</div>';
                }

                card.innerHTML = `
                    <div class="area-emoji">${enemy.emoji}</div>
                    <div class="area-info">
                        <div class="area-name">${enemy.name}</div>
                        <div class="area-desc">${enemy.description}</div>
                        ${statusText}
                    </div>
                `;

                if (isAvailable && !isCleared) {
                    card.onclick = () => openAreaPopup(index);
                }

                areaList.appendChild(card);
            });
        }

        // ã‚¨ãƒªã‚¢è©³ç´°ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‹ã
        function openAreaPopup(index) {
            selectedAreaIndex = index;
            const enemy = gameData.enemies[index];

            document.getElementById('popupTitle').textContent = enemy.name;
            document.getElementById('popupDesc').textContent = enemy.description;
            document.getElementById('popupEnemy').textContent = `${enemy.emoji} ${enemy.name}`;

            document.getElementById('areaPopup').classList.add('active');
        }

        // ã‚¨ãƒªã‚¢è©³ç´°ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‰ã˜ã‚‹
        function closeAreaPopup() {
            document.getElementById('areaPopup').classList.remove('active');
            selectedAreaIndex = null;
        }

        // ãƒãƒƒãƒ—ã‹ã‚‰æˆ¦é—˜é–‹å§‹
        function startBattleFromMap() {
            if (selectedAreaIndex === null) return;

            closeAreaPopup();
            currentEnemyIndex = selectedAreaIndex;
            startBattle(false);
        }

        // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚«ãƒ¼ãƒ‰èª­ã¿è¾¼ã¿
        function loadCharacterCards() {
            const container = document.getElementById('characterCards');
            container.innerHTML = '';

            gameData.characters.forEach(char => {
                const card = document.createElement('div');
                card.className = 'character-card';
                card.innerHTML = `
                    <div class="char-emoji">${char.emoji}</div>
                    <div class="char-name">${char.name}</div>
                    <div class="char-title">${char.title}</div>
                    <div class="char-stats">
                        <div class="stat"><div class="stat-value">${char.base_stats.hp}</div>HP</div>
                        <div class="stat"><div class="stat-value">${char.base_stats.mp}</div>MP</div>
                        <div class="stat"><div class="stat-value">${char.base_stats.atk}</div>ATK</div>
                        <div class="stat"><div class="stat-value">${char.base_stats.def}</div>DEF</div>
                        <div class="stat"><div class="stat-value">${char.base_stats.spd}</div>SPD</div>
                    </div>
                    <div class="char-skills">
                        ${char.skills.map(s => s.name).join(' / ')}
                    </div>
                `;
                card.onclick = () => selectCharacter(char, card);
                container.appendChild(card);
            });
        }

        // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼é¸æŠ
        function selectCharacter(char, cardElement) {
            selectedCharacter = char;
            document.querySelectorAll('.character-card').forEach(c => {
                c.classList.remove('selected');
                c.classList.add('dimmed');
            });
            cardElement.classList.add('selected');
            cardElement.classList.remove('dimmed');
            document.getElementById('startAdventureBtn').disabled = false;
        }

        // æˆ¦é—˜é–‹å§‹
        function startBattle(resetProgress = false) {
            if (!selectedCharacter) return;

            // åˆå›ã®ã¿ãƒ¬ãƒ™ãƒ«ãƒ»çµŒé¨“å€¤ãƒ»ã‚´ãƒ¼ãƒ«ãƒ‰ã‚’ãƒªã‚»ãƒƒãƒˆ
            if (resetProgress) {
                playerLevel = 1;
                playerExp = 0;
                playerGold = 0;
                currentEnemyIndex = 0;

                // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆæœŸåŒ–ï¼ˆãƒ¬ãƒ™ãƒ«ã«å¿œã˜ã¦ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¼·åŒ–ï¼‰
                const levelBonus = playerLevel - 1;
                playerStats = {
                    hp: selectedCharacter.base_stats.hp + (gameData.level_progression.stat_growth_per_level.hp * levelBonus),
                    mp: selectedCharacter.base_stats.mp + (gameData.level_progression.stat_growth_per_level.mp * levelBonus),
                    atk: selectedCharacter.base_stats.atk + (gameData.level_progression.stat_growth_per_level.atk * levelBonus),
                    def: selectedCharacter.base_stats.def + (gameData.level_progression.stat_growth_per_level.def * levelBonus),
                    spd: selectedCharacter.base_stats.spd + (gameData.level_progression.stat_growth_per_level.spd * levelBonus)
                };
                playerStats.currentHp = playerStats.hp;
                playerStats.currentMp = playerStats.mp;
            }
            // ãƒãƒƒãƒ—ã‹ã‚‰æ¥ãŸå ´åˆã¯ç¾åœ¨ã®HP/MPã‚’ç¶­æŒ

            // æ•µåˆæœŸåŒ–
            currentEnemy = gameData.enemies[currentEnemyIndex];
            enemyStats = {
                ...currentEnemy.base_stats,
                currentHp: currentEnemy.base_stats.hp,
                currentMp: currentEnemy.base_stats.mp
            };

            ultimateGauge = 0;
            playerDefenseBuff = false;
            enemyBurnTurns = 0;

            // UIæ›´æ–°
            document.getElementById('playerEmoji').textContent = selectedCharacter.emoji;
            document.getElementById('playerName').textContent = `${selectedCharacter.name} Lv.${playerLevel}`;
            document.getElementById('enemyEmoji').textContent = currentEnemy.emoji;
            document.getElementById('enemyName').textContent = currentEnemy.name;

            updateBattleUI();

            // ãƒœã‚¹ç™»å ´æ¼”å‡º
            if (currentEnemy.is_final_boss) {
                playFlash();
                addLog(`å¤§é­”ç‹ ${currentEnemy.name} ãŒç¾ã‚ŒãŸï¼`);
            } else if (currentEnemy.is_boss) {
                playFlash();
                addLog(`ãƒœã‚¹ ${currentEnemy.name} ãŒç¾ã‚ŒãŸï¼`);
            } else {
                addLog(`${currentEnemy.name}ãŒç¾ã‚ŒãŸï¼`);
            }

            switchScreen('battleScreen');
        }

        // æˆ¦é—˜UIæ›´æ–°
        function updateBattleUI() {
            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼HP
            const playerHpPercent = (playerStats.currentHp / playerStats.hp) * 100;
            document.getElementById('playerHpBar').style.width = playerHpPercent + '%';
            document.getElementById('playerHpText').textContent = `${playerStats.currentHp}/${playerStats.hp}`;

            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼MP
            const playerMpPercent = (playerStats.currentMp / playerStats.mp) * 100;
            document.getElementById('playerMpBar').style.width = playerMpPercent + '%';
            document.getElementById('playerMpText').textContent = `${playerStats.currentMp}/${playerStats.mp}`;

            // æ•µHP
            const enemyHpPercent = (enemyStats.currentHp / enemyStats.hp) * 100;
            document.getElementById('enemyHpBar').style.width = enemyHpPercent + '%';
            document.getElementById('enemyHpText').textContent = `${enemyStats.currentHp}/${enemyStats.hp}`;
        }

        // ãƒ­ã‚°è¿½åŠ 
        function addLog(text) {
            const log = document.getElementById('battleLog');
            log.textContent = text;
        }

        // ãƒ€ãƒ¡ãƒ¼ã‚¸è¨ˆç®—
        function calculateDamage(attacker, defender, multiplier, ignoreDefense = false) {
            let baseDamage = (attacker.atk * multiplier) - (ignoreDefense ? 0 : defender.def * 0.5);

            // ãƒ©ãƒ³ãƒ€ãƒ ä¿‚æ•°
            const randomFactor = 0.85 + Math.random() * 0.3;
            baseDamage *= randomFactor;

            // ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«
            const isCritical = Math.random() < 0.15;
            if (isCritical) {
                baseDamage *= 1.5;
            }

            baseDamage = Math.max(1, Math.floor(baseDamage));

            return { damage: baseDamage, isCritical };
        }

        // ãƒ€ãƒ¡ãƒ¼ã‚¸ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—
        function showDamagePopup(damage, isCritical, isEnemy = true) {
            const popup = document.createElement('div');
            popup.className = 'damage-popup' + (isCritical ? ' critical' : '');
            popup.textContent = (isCritical ? 'CRIT! ' : '') + damage;

            const targetArea = isEnemy ? document.querySelector('.enemy-area') : document.querySelector('.player-area');
            targetArea.style.position = 'relative';
            targetArea.appendChild(popup);

            setTimeout(() => popup.remove(), 1000);
        }

        // æ”»æ’ƒã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
        function playAttackAnimation(isPlayer = true) {
            const emoji = isPlayer ? document.getElementById('playerEmoji') : document.getElementById('enemyEmoji');
            emoji.style.animation = 'attack-rush 0.5s';
            setTimeout(() => emoji.style.animation = '', 500);
        }

        // ãƒ–ãƒ«ãƒ‘ãƒ«ã‚¹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
        function playBlurPulse(isEnemy = true) {
            const emoji = isEnemy ? document.getElementById('enemyEmoji') : document.getElementById('playerEmoji');
            emoji.style.animation = 'blur-pulse 0.3s';
            setTimeout(() => emoji.style.animation = '', 300);
        }

        // ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
        function playFlash() {
            const overlay = document.getElementById('flashOverlay');
            overlay.style.animation = 'flash-white 0.5s';
            setTimeout(() => overlay.style.animation = '', 500);
        }

        // é€šå¸¸æ”»æ’ƒ
        function playerAttack() {
            playAttackAnimation(true);
            setTimeout(() => {
                const { damage, isCritical } = calculateDamage(playerStats, enemyStats, 1.0);
                enemyStats.currentHp -= damage;

                playBlurPulse(true);
                showDamagePopup(damage, isCritical, true);
                addLog(`${selectedCharacter.name}ã®æ”»æ’ƒï¼ ${damage}ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼`);

                ultimateGauge = Math.min(100, ultimateGauge + 20);

                updateBattleUI();
                checkBattleEnd();
            }, 300);
        }

        // ã‚¹ã‚­ãƒ«ãƒ¡ãƒ‹ãƒ¥ãƒ¼é–‹ã
        function openSkillMenu() {
            const menu = document.getElementById('skillMenu');
            const options = document.getElementById('skillOptions');
            options.innerHTML = '';

            selectedCharacter.skills.forEach(skill => {
                const canUse = playerStats.currentMp >= skill.mp_cost;
                const option = document.createElement('div');
                option.className = 'skill-option' + (canUse ? '' : ' disabled');
                option.innerHTML = `
                    <div class="skill-name">${skill.name}</div>
                    <div class="skill-desc">${skill.description}</div>
                    <div class="skill-cost">æ¶ˆè²»MP: ${skill.mp_cost}</div>
                `;
                if (canUse) {
                    option.onclick = () => useSkill(skill);
                }
                options.appendChild(option);
            });

            menu.classList.add('active');
        }

        // ã‚¹ã‚­ãƒ«ãƒ¡ãƒ‹ãƒ¥ãƒ¼é–‰ã˜ã‚‹
        function closeSkillMenu() {
            document.getElementById('skillMenu').classList.remove('active');
        }

        // ã‚¹ã‚­ãƒ«ä½¿ç”¨
        function useSkill(skill) {
            closeSkillMenu();

            if (playerStats.currentMp < skill.mp_cost) return;
            playerStats.currentMp -= skill.mp_cost;

            if (skill.effect === 'defense_buff') {
                playerDefenseBuff = true;
                addLog(`${selectedCharacter.name}ã¯${skill.name}ã‚’ä½¿ã£ãŸï¼æ¬¡ã®ãƒ€ãƒ¡ãƒ¼ã‚¸ãŒåŠæ¸›ã™ã‚‹ï¼`);
                updateBattleUI();
                setTimeout(() => enemyTurn(), 1000);
                return;
            }

            playAttackAnimation(true);
            setTimeout(() => {
                const ignoreDefense = false;

                if (skill.effect === 'multi_hit') {
                    let totalDamage = 0;
                    for (let i = 0; i < skill.hit_count; i++) {
                        setTimeout(() => {
                            const { damage } = calculateDamage(playerStats, enemyStats, skill.damage_multiplier, ignoreDefense);
                            totalDamage += damage;
                            enemyStats.currentHp -= damage;
                            playBlurPulse(true);
                            showDamagePopup(damage, false, true);
                            updateBattleUI();

                            if (i === skill.hit_count - 1) {
                                addLog(`${selectedCharacter.name}ã®${skill.name}ï¼ ${skill.hit_count}é€£æ’ƒã§åˆè¨ˆ${totalDamage}ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼`);
                                ultimateGauge = Math.min(100, ultimateGauge + 15);
                                checkBattleEnd();
                            }
                        }, i * 200);
                    }
                } else {
                    const { damage, isCritical } = calculateDamage(playerStats, enemyStats, skill.damage_multiplier, ignoreDefense);
                    enemyStats.currentHp -= damage;

                    playBlurPulse(true);
                    showDamagePopup(damage, isCritical, true);
                    addLog(`${selectedCharacter.name}ã®${skill.name}ï¼ ${damage}ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼`);

                    if (skill.effect === 'burn') {
                        enemyBurnTurns = 3;
                        addLog(`æ•µã¯ç‚ã«åŒ…ã¾ã‚ŒãŸï¼`);
                    }

                    ultimateGauge = Math.min(100, ultimateGauge + 15);
                    updateBattleUI();
                    checkBattleEnd();
                }
            }, 300);
        }

        // å¿…æ®ºæŠ€
        function useUltimate() {
            if (ultimateGauge < 100 || playerStats.currentMp < selectedCharacter.ultimate.mp_cost) {
                addLog('å¿…æ®ºæŠ€ã‚²ãƒ¼ã‚¸ãŒè¶³ã‚Šãªã„ã€ã¾ãŸã¯MPãŒä¸è¶³ã—ã¦ã„ã¾ã™ï¼');
                return;
            }

            playerStats.currentMp -= selectedCharacter.ultimate.mp_cost;
            ultimateGauge = 0;

            playFlash();
            setTimeout(() => {
                const ultimate = selectedCharacter.ultimate;
                const ignoreDefense = ultimate.effect === 'ignore_def';

                if (ultimate.effect === 'multi_hit' || ultimate.hit_count) {
                    let totalDamage = 0;
                    for (let i = 0; i < ultimate.hit_count; i++) {
                        setTimeout(() => {
                            const { damage } = calculateDamage(playerStats, enemyStats, ultimate.damage_multiplier, ignoreDefense);
                            totalDamage += damage;
                            enemyStats.currentHp -= damage;
                            playBlurPulse(true);
                            showDamagePopup(damage, true, true);
                            updateBattleUI();

                            if (i === ultimate.hit_count - 1) {
                                addLog(`${selectedCharacter.name}ã®${ultimate.name}ï¼ åˆè¨ˆ${totalDamage}ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼`);
                                checkBattleEnd();
                            }
                        }, i * 300);
                    }
                } else {
                    const { damage } = calculateDamage(playerStats, enemyStats, ultimate.damage_multiplier, ignoreDefense);
                    enemyStats.currentHp -= damage;

                    playBlurPulse(true);
                    showDamagePopup(damage, true, true);
                    addLog(`${selectedCharacter.name}ã®${ultimate.name}ï¼ ${damage}ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼`);

                    updateBattleUI();
                    checkBattleEnd();
                }
            }, 500);
        }

        // ã‚¢ã‚¤ãƒ†ãƒ ãƒ¡ãƒ‹ãƒ¥ãƒ¼é–‹ã
        function openItemMenu() {
            const menu = document.getElementById('itemMenu');
            const options = document.getElementById('itemOptions');
            options.innerHTML = '';

            gameData.items.forEach(item => {
                const count = playerInventory[item.id] || 0;
                const option = document.createElement('div');
                option.className = 'skill-option' + (count > 0 ? '' : ' disabled');
                option.innerHTML = `
                    <div class="skill-name">${item.emoji} ${item.name} (${count}å€‹)</div>
                    <div class="skill-desc">${item.description}</div>
                `;
                if (count > 0) {
                    option.onclick = () => useItem(item);
                }
                options.appendChild(option);
            });

            menu.classList.add('active');
        }

        // ã‚¢ã‚¤ãƒ†ãƒ ãƒ¡ãƒ‹ãƒ¥ãƒ¼é–‰ã˜ã‚‹
        function closeItemMenu() {
            document.getElementById('itemMenu').classList.remove('active');
        }

        // ã‚¢ã‚¤ãƒ†ãƒ ä½¿ç”¨
        function useItem(item) {
            closeItemMenu();

            if (!playerInventory[item.id] || playerInventory[item.id] <= 0) return;

            playerInventory[item.id]--;

            if (item.effect === 'restore_hp') {
                playerStats.currentHp = Math.min(playerStats.hp, playerStats.currentHp + item.value);
                addLog(`${item.name}ã‚’ä½¿ã£ãŸï¼ HPãŒ${item.value}å›å¾©ã—ãŸï¼`);
            } else if (item.effect === 'restore_mp') {
                playerStats.currentMp = Math.min(playerStats.mp, playerStats.currentMp + item.value);
                addLog(`${item.name}ã‚’ä½¿ã£ãŸï¼ MPãŒ${item.value}å›å¾©ã—ãŸï¼`);
            } else if (item.effect === 'restore_all') {
                playerStats.currentHp = playerStats.hp;
                playerStats.currentMp = playerStats.mp;
                addLog(`${item.name}ã‚’ä½¿ã£ãŸï¼ HPãƒ»MPãŒå…¨å›å¾©ã—ãŸï¼`);
            }

            updateBattleUI();
            setTimeout(() => enemyTurn(), 1000);
        }

        // æ’¤é€€
        function retreat() {
            addLog('æˆ¦é—˜ã‹ã‚‰é€ƒã’å‡ºã—ãŸï¼');
            setTimeout(() => returnToTitle(), 1000);
        }

        // æ•µã®ã‚¿ãƒ¼ãƒ³
        function enemyTurn() {
            if (enemyStats.currentHp <= 0) return;

            setTimeout(() => {
                // ç«å‚·ãƒ€ãƒ¡ãƒ¼ã‚¸
                if (enemyBurnTurns > 0) {
                    const burnDamage = Math.floor(enemyStats.hp * 0.1);
                    enemyStats.currentHp -= burnDamage;
                    showDamagePopup(burnDamage, false, true);
                    addLog(`æ•µã¯ç‚ã®ãƒ€ãƒ¡ãƒ¼ã‚¸ã‚’å—ã‘ãŸï¼ ${burnDamage}ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼`);
                    enemyBurnTurns--;
                    updateBattleUI();

                    if (enemyStats.currentHp <= 0) {
                        checkBattleEnd(false);
                        return;
                    }
                }

                // æ•µã®AIåˆ¤æ–­
                let action = 'attack'; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯é€šå¸¸æ”»æ’ƒ
                let selectedSkill = null;

                const hpPercent = (enemyStats.currentHp / enemyStats.hp) * 100;

                // heal_priority: HPãŒä½ã„å ´åˆã¯å›å¾©
                if (currentEnemy.ai_type === 'heal_priority' && currentEnemy.heal_skill) {
                    if (hpPercent <= currentEnemy.heal_skill.trigger_hp_percent &&
                        enemyStats.currentMp >= currentEnemy.heal_skill.mp_cost) {
                        action = 'heal';
                    }
                }

                // å›å¾©ä»¥å¤–ã®å ´åˆã€æ”»æ’ƒæ–¹æ³•ã‚’æ±ºå®š
                if (action !== 'heal') {
                    if (currentEnemy.ai_type === 'strong_attack') {
                        // ã‚¹ã‚­ãƒ«å„ªå…ˆ
                        if (currentEnemy.skills && currentEnemy.skills.length > 0) {
                            const skill = currentEnemy.skills[0];
                            if (enemyStats.currentMp >= skill.mp_cost) {
                                action = 'skill';
                                selectedSkill = skill;
                            }
                        }
                    } else if (currentEnemy.ai_type === 'random') {
                        // ãƒ©ãƒ³ãƒ€ãƒ ã§æ”»æ’ƒã‹ã‚¹ã‚­ãƒ«
                        if (currentEnemy.skills && currentEnemy.skills.length > 0 && Math.random() < 0.5) {
                            const skill = currentEnemy.skills[0];
                            if (enemyStats.currentMp >= skill.mp_cost) {
                                action = 'skill';
                                selectedSkill = skill;
                            }
                        }
                    }
                }

                // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
                if (action === 'heal') {
                    // å›å¾©
                    const healSkill = currentEnemy.heal_skill;
                    enemyStats.currentMp -= healSkill.mp_cost;
                    enemyStats.currentHp = Math.min(enemyStats.hp, enemyStats.currentHp + healSkill.heal_amount);

                    addLog(`${currentEnemy.name}ã¯${healSkill.name}ã‚’ä½¿ã£ãŸï¼ HPãŒ${healSkill.heal_amount}å›å¾©ã—ãŸï¼`);
                    updateBattleUI();
                } else if (action === 'skill' && selectedSkill) {
                    // ã‚¹ã‚­ãƒ«æ”»æ’ƒ
                    enemyStats.currentMp -= selectedSkill.mp_cost;
                    playAttackAnimation(false);
                    setTimeout(() => {
                        let { damage, isCritical } = calculateDamage(enemyStats, playerStats, selectedSkill.damage_multiplier);

                        if (playerDefenseBuff) {
                            damage = Math.floor(damage * 0.5);
                            playerDefenseBuff = false;
                            addLog(`é˜²å¾¡åŠ¹æœã§ãƒ€ãƒ¡ãƒ¼ã‚¸ãŒåŠæ¸›ã—ãŸï¼`);
                        }

                        playerStats.currentHp -= damage;

                        playBlurPulse(false);
                        showDamagePopup(damage, isCritical, false);
                        addLog(`${currentEnemy.name}ã®${selectedSkill.name}ï¼ ${damage}ãƒ€ãƒ¡ãƒ¼ã‚¸ã‚’å—ã‘ãŸï¼`);

                        updateBattleUI();
                        checkBattleEnd(false);
                    }, 300);
                } else {
                    // é€šå¸¸æ”»æ’ƒ
                    playAttackAnimation(false);
                    setTimeout(() => {
                        let { damage, isCritical } = calculateDamage(enemyStats, playerStats, 1.0);

                        if (playerDefenseBuff) {
                            damage = Math.floor(damage * 0.5);
                            playerDefenseBuff = false;
                            addLog(`é˜²å¾¡åŠ¹æœã§ãƒ€ãƒ¡ãƒ¼ã‚¸ãŒåŠæ¸›ã—ãŸï¼`);
                        }

                        playerStats.currentHp -= damage;

                        playBlurPulse(false);
                        showDamagePopup(damage, isCritical, false);
                        addLog(`${currentEnemy.name}ã®æ”»æ’ƒï¼ ${damage}ãƒ€ãƒ¡ãƒ¼ã‚¸ã‚’å—ã‘ãŸï¼`);

                        updateBattleUI();
                        checkBattleEnd(false);
                    }, 300);
                }
            }, 1000);
        }

        // æˆ¦é—˜çµ‚äº†ãƒã‚§ãƒƒã‚¯
        function checkBattleEnd(isPlayerTurn = true) {
            if (enemyStats.currentHp <= 0) {
                setTimeout(() => showVictory(), 500);
            } else if (playerStats.currentHp <= 0) {
                setTimeout(() => showDefeat(), 500);
            } else if (isPlayerTurn) {
                // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚¿ãƒ¼ãƒ³å¾Œã«ã®ã¿æ•µã®ã‚¿ãƒ¼ãƒ³ã‚’å‘¼ã³å‡ºã™
                setTimeout(() => enemyTurn(), 1500);
            }
        }

        // å‹åˆ©
        function showVictory() {
            // çµŒé¨“å€¤ã¨ã‚´ãƒ¼ãƒ«ãƒ‰ç²å¾—
            playerExp += currentEnemy.exp_reward;
            playerGold += currentEnemy.gold_reward;

            // æ•µã‚’å€’ã—ãŸã“ã¨ã‚’è¨˜éŒ²
            if (!clearedEnemies.includes(currentEnemyIndex)) {
                clearedEnemies.push(currentEnemyIndex);
            }

            // ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ãƒã‚§ãƒƒã‚¯
            let leveledUp = false;
            let newLevel = playerLevel;

            for (let i = 0; i < gameData.level_progression.exp_table.length; i++) {
                const levelData = gameData.level_progression.exp_table[i];
                if (playerExp >= levelData.required_exp && levelData.level > playerLevel) {
                    newLevel = levelData.level;
                    leveledUp = true;
                }
            }

            if (leveledUp) {
                playerLevel = newLevel;
                // ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—æ™‚ã«ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’æ›´æ–°
                updatePlayerStatsForLevel();
            }

            // æœ€çµ‚ãƒœã‚¹æ’ƒç ´æ™‚ã¯ã‚¨ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã¸
            if (currentEnemy.is_final_boss) {
                showEnding();
                return;
            }

            // å‹åˆ©ç”»é¢è¡¨ç¤º
            document.getElementById('resultTitle').textContent = 'å‹åˆ©ï¼';
            document.getElementById('resultTitle').className = 'result-title victory';

            let resultHTML = `
                <div style="margin-bottom: 10px;">çµŒé¨“å€¤: +${currentEnemy.exp_reward} (åˆè¨ˆ: ${playerExp})</div>
                <div style="margin-bottom: 10px;">ã‚´ãƒ¼ãƒ«ãƒ‰: +${currentEnemy.gold_reward} (åˆè¨ˆ: ${playerGold})</div>
            `;

            if (leveledUp) {
                resultHTML += `
                    <div style="color: #ffd700; font-size: 1.5rem; margin-top: 20px; animation: glow-pulse 1s infinite;">
                        ğŸ‰ ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ï¼ Lv.${playerLevel} ğŸ‰
                    </div>
                `;
            }

            document.getElementById('resultInfo').innerHTML = resultHTML;

            // ãƒœã‚¿ãƒ³ã‚’æ›´æ–°
            const resultButtons = document.querySelector('.result-buttons');
            resultButtons.innerHTML = `
                <button class="glass-button" onclick="returnToTitle()">ã‚¿ã‚¤ãƒˆãƒ«ã¸</button>
                <button class="glass-button" onclick="returnToMap()">ãƒãƒƒãƒ—ã¸</button>
            `;

            switchScreen('resultScreen');
        }

        // ãƒãƒƒãƒ—ã«æˆ»ã‚‹
        function returnToMap() {
            saveGame(); // è‡ªå‹•ã‚»ãƒ¼ãƒ–
            updateMapScreen();
            switchScreen('mapScreen');
        }

        // ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—æ™‚ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
        function updatePlayerStatsForLevel() {
            const levelBonus = playerLevel - 1;
            const growth = gameData.level_progression.stat_growth_per_level;

            playerStats.hp = selectedCharacter.base_stats.hp + (growth.hp * levelBonus);
            playerStats.mp = selectedCharacter.base_stats.mp + (growth.mp * levelBonus);
            playerStats.atk = selectedCharacter.base_stats.atk + (growth.atk * levelBonus);
            playerStats.def = selectedCharacter.base_stats.def + (growth.def * levelBonus);
            playerStats.spd = selectedCharacter.base_stats.spd + (growth.spd * levelBonus);

            // HP/MPã‚‚å›å¾©
            playerStats.currentHp = playerStats.hp;
            playerStats.currentMp = playerStats.mp;
        }

        // æ•—åŒ—
        function showDefeat() {
            document.getElementById('resultTitle').textContent = 'æ•—åŒ—...';
            document.getElementById('resultTitle').className = 'result-title defeat';
            document.getElementById('resultInfo').innerHTML = `
                <div>ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦ã—ã¾ã™ã‹ï¼Ÿ</div>
            `;

            // ãƒœã‚¿ãƒ³ã‚’æ›´æ–°
            const resultButtons = document.querySelector('.result-buttons');
            resultButtons.innerHTML = `
                <button class="glass-button" onclick="returnToTitle()">ã‚¿ã‚¤ãƒˆãƒ«ã¸</button>
                <button class="glass-button" onclick="retryBattle()">ã‚‚ã†ä¸€åº¦</button>
            `;

            switchScreen('resultScreen');
        }

        // å†æˆ¦
        function retryBattle() {
            // åŒã˜æ•µã¨å†æˆ¦ï¼ˆcurrentEnemyIndexã¯ãã®ã¾ã¾ï¼‰
            startBattle(false);
        }

        // ã‚¿ã‚¤ãƒˆãƒ«ã«æˆ»ã‚‹
        function returnToTitle() {
            saveGame(); // ã‚»ãƒ¼ãƒ–ã—ã¦ã‹ã‚‰æˆ»ã‚‹
            checkSaveData(); // ãƒœã‚¿ãƒ³ã‚’æ›´æ–°
            switchScreen('titleScreen');
        }


        // ã‚¨ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢
        function showEnding() {
            // ã‚¨ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒªãƒ†ãƒ©ãƒ«ã‚’è©•ä¾¡
            const endingScreen = document.getElementById('endingScreen');
            const endingInfo = endingScreen.querySelector('.result-info');
            endingInfo.innerHTML = `
                <div style="margin-bottom: 20px;">ğŸ‘‘ ç‹å† ã‚’å–ã‚Šæˆ»ã—ãŸï¼ ğŸ‘‘</div>
                <div style="margin-bottom: 20px;">ã‚¢ãƒ«ã‚¬ãƒ¬ã‚¤ã‚¢ã«å¹³å’ŒãŒæˆ»ã£ãŸã€‚</div>
                <div style="margin-top: 30px; color: #c8b8ff;">
                    <div>æœ€çµ‚ãƒ¬ãƒ™ãƒ«: Lv.${playerLevel}</div>
                    <div>ç²å¾—ã‚´ãƒ¼ãƒ«ãƒ‰: ${playerGold}</div>
                </div>
            `;
            switchScreen('endingScreen');
        }

        // åˆæœŸåŒ–å®Ÿè¡Œ
        init();
    </script>
</body>
</html>
